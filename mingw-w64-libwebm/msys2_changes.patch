--- a/CMakeLists.txt	2015-12-09 08:12:34.000000000 -0800
+++ b/CMakeLists.txt	2021-04-04 17:06:52.969065200 -0700
@@ -12,7 +12,7 @@
 set(LIBWEBM_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}")
 
 # Libwebm section.
-add_library(webm STATIC
+set(LIBWEBM_SRCS
             "${LIBWEBM_SRC_DIR}/mkvmuxer.cpp"
             "${LIBWEBM_SRC_DIR}/mkvmuxer.hpp"
             "${LIBWEBM_SRC_DIR}/mkvmuxertypes.hpp"
@@ -25,11 +25,19 @@
             "${LIBWEBM_SRC_DIR}/mkvwriter.cpp"
             "${LIBWEBM_SRC_DIR}/mkvwriter.hpp"
             "${LIBWEBM_SRC_DIR}/webmids.hpp")
+
+add_library(webm-shared SHARED ${LIBWEBM_SRCS})
+add_library(webm-static STATIC ${LIBWEBM_SRCS})
+
+set_property(TARGET webm-shared PROPERTY POSITION_INDEPENDENT_CODE 1)
+
 if(WIN32)
   # Use libwebm and libwebm.lib for project and library name on Windows (instead
   # webm and webm.lib).
-  set_target_properties(webm PROPERTIES PROJECT_LABEL libwebm)
-  set_target_properties(webm PROPERTIES PREFIX lib)
+  set_target_properties(webm-shared PROPERTIES OUTPUT_NAME webm)
+  set_target_properties(webm-static PROPERTIES OUTPUT_NAME webm)
+  # Link GCC libs statically (uncomment in the next update for dynamic library)
+  target_link_libraries(webm-shared LINK_PUBLIC -static stdc++ -dynamic)
 endif(WIN32)
 
 include_directories("${LIBWEBM_SRC_DIR}")
@@ -62,3 +70,21 @@
                "${LIBWEBM_SRC_DIR}/webm2pes.cc"
                "${LIBWEBM_SRC_DIR}/webm2pes.h")
 target_link_libraries(webm2pes LINK_PUBLIC webm)
+
+# This stuff copied directly from the Arch MAKEPKG
+install(
+FILES
+  "mkvmuxer.hpp"
+  "mkvmuxertypes.hpp"
+  "mkvmuxerutil.hpp"
+  "mkvparser.hpp"
+  "mkvreader.hpp"
+  "mkvwriter.hpp"
+  "webmids.hpp"
+DESTINATION
+  "include/webm")
+
+install(TARGETS webm-static webm-shared vttdemux webm2pes
+        RUNTIME DESTINATION bin
+        ARCHIVE DESTINATION lib
+        LIBRARY DESTINATION lib)

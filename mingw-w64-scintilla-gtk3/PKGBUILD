# Maintainer: taozuhong <taozuhong@gmail.com>

_realname=scintilla
pkgbase=mingw-w64-${_realname}-gtk3
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}-gtk3"
pkgver=4.4.4
pkgrel=1
pkgdesc="A text widget adding syntax highlighting and more to GNOME (mingw-w64)"
arch=('any')
url="https://www.scintilla.org/"
license=("LGPL")
makedepends=("${MINGW_PACKAGE_PREFIX}-gcc"
             "${MINGW_PACKAGE_PREFIX}-pkg-config"
             "${MINGW_PACKAGE_PREFIX}-python3")
depends=("${MINGW_PACKAGE_PREFIX}-gtk3")
source=("https://www.scintilla.org/scintilla444.tgz")
sha256sums=('1ee9dda1ee99d2ba8fed00991bc2d7da20ef31da7db49a72e28c441ca3595afe')

prepare() {
  cd ${_realname}
}

build() {
  [[ -d build-${MINGW_CHOST} ]] && rm -rf build-${MINGW_CHOST}
  mkdir -p build-${MINGW_CHOST}
  
  cd ${srcdir}/${_realname}/gtk
  make GTK3=1 PREFIX='${MINGW_PREFIX}' BUILD='${MINGW_CHOST}' HOST='${MINGW_CHOST}' TARGET='${MINGW_CHOST}'
}

package() {
  cd "${srcdir}/build-${MINGW_CHOST}"
  mkdir -p {bin,lib,include,share}
  mkdir -p {include,share}/${_realname}
  
  # library
  install -Dm644 "${srcdir}/${_realname}/bin/liblexilla.a" "${pkgdir}${MINGW_PREFIX}/lib"
  install -Dm644 "${srcdir}/${_realname}/bin/scintilla.a" "${pkgdir}${MINGW_PREFIX}/lib"
  install -Dm644 "${srcdir}/${_realname}/bin/liblexilla.so" "${pkgdir}${MINGW_PREFIX}/bin"
  install -Dm644 "${srcdir}/${_realname}/bin/libscintilla.so" "${pkgdir}${MINGW_PREFIX}/bin"
  
  # include
  install -Dm644 "${srcdir}/${_realname}/include/ILexer.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/ILoader.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/Platform.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/Sci_Position.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/SciLexer.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/Scintilla.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/Scintilla.iface" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/include/ScintillaWidget.h" "${pkgdir}${MINGW_PREFIX}/include/${_realname}"
  
  # License
  install -Dm644 "${srcdir}/${_realname}/License.txt" "${pkgdir}${MINGW_PREFIX}/share/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/version.txt" "${pkgdir}${MINGW_PREFIX}/share/${_realname}"
  install -Dm644 "${srcdir}/${_realname}/README" "${pkgdir}${MINGW_PREFIX}/share/${_realname}"
}
